<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.loha.flippedclassroom.mapper.ScoreMapper">
    <resultMap id="seminarScoreMap" type="SeminarScore">
        <id column="klass_seminar_id" property="klassSeminarId"/>
        <id column="team_id" property="teamId"/>
        <result column="total_score" property="totalScore"/>
        <result column="presentation_score" property="presentationScore"/>
        <result column="question_score" property="questionScore"/>
        <result column="report_score" property="reportScore"/>
        <association property="team" select="com.loha.flippedclassroom.mapper.TeamMapper.selectTeamById"
                     column="team_id"></association>
    </resultMap>

    <resultMap id="roundScoreMap" type="RoundScore">
        <id column="round_id" property="roundId"/>
        <id column="team_id" property="teamId"/>
        <result column="total_score" property="totalScore"/>
        <result column="presentation_score" property="presentationScore" jdbcType="DECIMAL"/>
        <result column="question_score" property="questionScore" jdbcType="DECIMAL"/>
        <result column="report_score" property="reportScore" jdbcType="DECIMAL"/>
        <association property="round" select="com.loha.flippedclassroom.mapper.RoundMapper.selectRoundById"
                     column="round_id"></association>
        <association property="team" select="com.loha.flippedclassroom.mapper.TeamMapper.selectTeamById"
                     column="team_id"></association>
    </resultMap>

    <select id="selectRoundScore" parameterType="RoundScore" resultMap="roundScoreMap">
        select *
        from round_score
        where round_id = #{roundId}
          and team_id = #{teamId}
    </select>

    <select id="selectSeminarScore" parameterType="Map" resultMap="seminarScoreMap">
        select seminar_score.*
        from seminar_score,
             klass_seminar
        where klass_id = #{klassId}
          and seminar_id = #{seminarId}
          and id = klass_seminar_id
          and team_id = #{teamId}
    </select>

    <select id="selectSeminarScoreByKlassSeminarId" resultMap="seminarScoreMap">
        select *
        from seminar_score
        where klass_seminar_id = #{id}
    </select>

    <select id="selectSeminarScoreByKlassSeminarIdAndTeamId" parameterType="Map" resultMap="seminarScoreMap">
        select *
        from seminar_score
        where klass_seminar_id=#{klassSeminarId}
        and team_id=#{teamId}
    </select>

    <insert id="insertSeminarScore" useGeneratedKeys="true" parameterType="Map">
        insert into seminar_score (klass_seminar_id, team_id)
        values (#{klassSeminarId},#{teamId})
    </insert>

    <update id="updateSeminarScore" parameterType="SeminarScore">
        update seminar_score set total_score=#{totalScore}, presentation_score=#{presentationScore}, question_score=#{questionScore}, report_score=#{reportScore}
        where klass_seminar_id=#{klassSeminarId} and team_id=#{teamId}
    </update>

    <insert id="insertRoundScore" parameterType="RoundScore">
        insert into round_score (round_id, team_id, total_score, presentation_score, question_score, report_score)
        values (#{roundId},#{teamId},#{totalScore},#{presentationScore},#{questionScore},#{reportScore})
    </insert>

    <update id="updateRoundScore" parameterType="RoundScore">
        update round_score set total_score=#{totalScore}, presentation_score=#{presentationScore},question_score=#{questionScore},
                               report_score=#{reportScore}
        where round_id=#{roundId} and team_id=#{teamId}
    </update>
</mapper>